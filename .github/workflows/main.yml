name: Build and Deploy

on:
  push:
    branches: [ main ]

jobs:
  build-and-deploy:
    runs-on: self-hosted   # Use your EC2 self-hosted runner

    steps:
      # 1️⃣ Checkout code
      - name: Checkout code
        uses: actions/checkout@v3

      # 2️⃣ Install dependencies
      - name: Install dependencies
        run: npm ci

      # 3️⃣ Build the project
      - name: Build project
        run: npm run build

      # 4️⃣ Deploy to EC2
      - name: Deploy to EC2
        run: |
          pm2 delete sajag-frontend || true
          pm2 serve build 3000 --name sajag-frontend --spa